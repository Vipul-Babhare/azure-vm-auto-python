name: ðŸ§  Deploy Pipeline

on:
  workflow_dispatch:

jobs:
  tf_serve:
    runs-on: ubuntu-latest

    steps:
    - name: â¬‡ï¸ Checkout repo
      uses: actions/checkout@v3

    - name: ðŸ”‘ Write SSH Key
      run: |
        echo "${{ secrets.SSH_PRIVATE_KEY }}" > key.pem
        chmod 600 key.pem

    - name: ðŸš€ Deploy TensorFlow Model
      run: |
        ssh -o StrictHostKeyChecking=no -i key.pem azureuser@${{ secrets.STATIC_VM_IP }} <<'EOF'
        cd azure-vm-auto-python
        sudo docker run -d \
        --name tf-serving \
        --network tfnet \
        -p 8501:8501 \
        -v $PWD/models/my_model:/models/my_model \
        -e MODEL_NAME=my_model \
        tensorflow/serving
        EOF

